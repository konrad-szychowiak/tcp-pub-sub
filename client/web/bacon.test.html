<!DOCTYPE html>
<html data-color-mode="dark" data-dark-theme="dark_dimmed"
      lang="en">
<head>
    <title>Bacon Test</title>
    <link href="https://unpkg.com/@primer/css@^16.0.0/dist/primer.css" rel="stylesheet"/>
    <style>
      .octicon {
        display: inline-block;
        vertical-align: text-top;
        fill: currentColor;
        overflow: visible;
      }
    </style>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bacon.js/2.0.9/Bacon.js"></script>
</head>

<body x-data>

c1
<!-- messages -->
<section class="container-md p-2">
    <template x-for="m in $store.convo[0]">
        <!-- message -->
        <div class="TimelineItem">
            <div class="TimelineItem-badge color-bg-danger-emphasis color-fg-on-emphasis">
                <svg class="octicon" height="16" viewBox="0 0 16 16" width="16"
                     xmlns="http://www.w3.org/2000/svg">
                    <path
                            d="M2.75 2.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h2a.75.75 0 01.75.75v2.19l2.72-2.72a.75.75 0 01.53-.22h4.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25H2.75zM1 2.75C1 1.784 1.784 1 2.75 1h10.5c.966 0 1.75.784 1.75 1.75v7.5A1.75 1.75 0 0113.25 12H9.06l-2.573 2.573A1.457 1.457 0 014 13.543V12H2.75A1.75 1.75 0 011 10.25v-7.5z"
                            fill-rule="evenodd"></path>
                </svg>
            </div>
            <div class="TimelineItem-body" x-text="m"></div>
        </div>
    </template>
    <div class="TimelineItem-break ml-0"></div>
</section>


<section class="container-md p-2">
        <template x-for="m in $store.convo[1]">
    <!-- message -->
    <div class="TimelineItem">
        <div class="TimelineItem-badge color-bg-danger-emphasis color-fg-on-emphasis">
            <svg class="octicon" height="16" viewBox="0 0 16 16" width="16"
                 xmlns="http://www.w3.org/2000/svg">
                <path
                        d="M2.75 2.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h2a.75.75 0 01.75.75v2.19l2.72-2.72a.75.75 0 01.53-.22h4.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25H2.75zM1 2.75C1 1.784 1.784 1 2.75 1h10.5c.966 0 1.75.784 1.75 1.75v7.5A1.75 1.75 0 0113.25 12H9.06l-2.573 2.573A1.457 1.457 0 014 13.543V12H2.75A1.75 1.75 0 011 10.25v-7.5z"
                        fill-rule="evenodd"></path>
            </svg>
        </div>
        <div class="TimelineItem-body" x-text="m"></div>
    </div>
        </template>
    <div class="TimelineItem-break ml-0"></div>
</section>


<section class="container-sm mt-5" x-data="{ mc: 0 }">
        <input placeholder="message" type="text" x-mode="mt" id="mt"/>
        <button id="mock-send">send</button>
</section>
<pre x-text="JSON.stringify($store)"></pre>

<script>
    let $ = (selector) => document.querySelector(selector)
    var clickE = Bacon
        .fromEvent($("#mock-send"), "click")

    clickE.onValue(()=> { let a = Alpine.store('madeM');
        let i = 0;
        if (Math.random() > 0.5) i = 1;
        Alpine.store('convo')[i].push(a)
        })

    var freshMessage = Bacon
        .fromEvent($('#mt'), 'keyup')
        .map((event) => $('#'+event.target.id).value)
        .onValue(el => Alpine.store('madeM', el))



    document.addEventListener('alpine:init', () => {
        Alpine.store('madeM','')
        Alpine.store('convo', {0: [], 1: []})
    })

</script>
</body>
</html>